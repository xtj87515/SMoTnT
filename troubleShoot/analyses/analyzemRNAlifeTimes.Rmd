---
title: "R Notebook"
output: html_notebook
---

This is plotting when the source code is the same as experiment 1, and the output decay rates are all somehow inflated
```{r}
numGenes <- 100
numTechReps <- 20

```


```{r}
lifeTimeFiles <- list.files("../output/mRNA_lifeTimes/")

timeAvgLifeTimes <- as_tibble(matrix(NA, nrow = numGenes, ncol = numTechReps))
for (i in 1:numTechReps){
    fileContent <- readLines(paste0("../output/mRNA_lifeTimes/", lifeTimeFiles[i]))
    
    timeAvgLifeTimes[, i] <- unlist(lapply(fileContent,function(x){
            str_trim(x) %>%  # takes out the space at the end of each line
            str_split(" ") %>% 
            unlist() %>% 
            as.numeric() %>%
            .[3:length(.)] %>% # removes the first two numbers in each line, 1st=geneID, 2nd=number of life times collected, the rest are the lifeTimes 
            mean() # get the time averaged life times for each line(i.e. gene)
        }))
}

meanLifeTimes <- timeAvgLifeTimes %>%
    mutate(ORF = 1:100) %>% 
    pivot_longer(names_to = "techRep", values_to = "timeAvgLifeTime", !ORF) %>% 
    group_by(ORF) %>%
    summarise(timeRepAvgLifeTime = mean(timeAvgLifeTime)) %>% 
    mutate(outputMMDR = 1/timeRepAvgLifeTime, # MMDR = mean mRNA decay rate
           inputMMDR = read_tsv("../input/allGenesDecrEqualsSynr_dc_0_r_0_S.cer.mRNA.ini.abndc.syn.dec", col_names = FALSE) %>% pull(X4),
           RMMDR = outputMMDR/inputMMDR) # relative mean mRNA decay rate = output/input decay rate

meanLifeTimes 

meanLifeTimes%>% 
    # filter(RMMDR < 3) %>% # there are some outliers RMMDR equal to 3 or even 4
    ggplot(aes(y=RMMDR)) +
        geom_boxplot(outlier.size = 0.1) +
        theme_bw() +
        labs(x="dc_0_r_0",
           y="Ratio between output/input decay rates") +
        theme(
        text = element_text(size = 13),
        )
```
This is plotting when the source code is the same as experiment 1, getting the mRNA count numbers from raw output
```{r}
mRNAcountFiles <- list.files("../output/gene_sp_mRNAcount_perMin/")

timeAvgmRNAcount <- as_tibble(matrix(NA, nrow = numGenes, ncol = numTechReps))
for (i in 1:numTechReps){
    fileContent <- read_delim(paste0("../output/gene_sp_mRNAcount_perMin/", mRNAcountFiles[i]), col_names = FALSE)[,2:101] # ignore the first col=timeMark,last col= NA
    timeAvgmRNAcount[, i] <- apply(fileContent, 2, mean)
}

meanmRNAcount <- timeAvgmRNAcount %>%
    mutate(ORF = 1:100) %>% 
    pivot_longer(names_to = "techRep", values_to = "timeAvgLifeTime", !ORF) %>% 
    group_by(ORF) %>%
    summarise(timeRepAvgLifeTime = mean(timeAvgLifeTime))

meanmRNAcount

meanmRNAcount%>% 
        mutate(relmRNAcount = timeRepAvgLifeTime/200) %>% 
        ggplot(aes(y=relmRNAcount)) +
        geom_boxplot(outlier.size = 0.1) +
        theme_bw() +
        labs(x="dc_0_r_0",
           y="Relative mean mRNA count\n(avgered by time and rep)") +
        theme(
        text = element_text(size = 13),
        )
```


This is when in the source code, all printed life times are scaled by lifeTime*1.025, resulting in expected output decay rates
```{r}
lifeTimeFiles <- list.files("../output/")[1:numTechReps] # excluding the "mRNA_lifeTimes" folder

timeAvgLifeTimes <- as_tibble(matrix(NA, nrow = numGenes, ncol = numTechReps))
for (i in 1:numTechReps){
    fileContent <- readLines(paste0("../output/", lifeTimeFiles[i]))
    
    timeAvgLifeTimes[, i] <- unlist(lapply(fileContent,function(x){
            str_trim(x) %>%  # takes out the space at the end of each line
            str_split(" ") %>% 
            unlist() %>% 
            as.numeric() %>%
            .[3:length(.)] %>% # removes the first two numbers in each line, 1st=geneID, 2nd=number of life times collected, the rest are the lifeTimes 
            mean() # get the time averaged life times for each line(i.e. gene)
        }))
}

meanLifeTimes <- timeAvgLifeTimes %>%
    mutate(ORF = 1:100) %>% 
    pivot_longer(names_to = "techRep", values_to = "timeAvgLifeTime", !ORF) %>% 
    group_by(ORF) %>%
    summarise(timeRepAvgLifeTime = mean(timeAvgLifeTime)) %>% 
    mutate(outputMMDR = 1/timeRepAvgLifeTime, # MMDR = mean mRNA decay rate
           inputMMDR = read_tsv("../input/allGenesDecrEqualsSynr_dc_0_r_0_S.cer.mRNA.ini.abndc.syn.dec", col_names = FALSE) %>% pull(X4),
           RMMDR = outputMMDR/inputMMDR) # relative mean mRNA decay rate = output/input decay rate

meanLifeTimes 

meanLifeTimes%>% 
    # filter(RMMDR < 3) %>% # there are some outliers RMMDR equal to 3 or even 4
    ggplot(aes(y=RMMDR)) +
        geom_boxplot(outlier.size = 0.1) +
        theme_bw() +
        labs(x="dc_0_r_0",
           y="Ratio between output/input decay rates") +
        theme(
        text = element_text(size = 13),
        )
```


Check the actual output mRNA synthesis rates, source code same as experiment 1
```{r}
synCountFiles <- list.files("../output/gene_sp_synCount_perMin/")

timeAvgSynCount <- as_tibble(matrix(NA, nrow = numGenes, ncol = numTechReps))
for (i in 1:numTechReps){
    fileContent <- read_delim(paste0("../output/gene_sp_synCount_perMin/", synCountFiles[i]), col_names = FALSE)[,2:101] # ignore the first col=timeMark,last col= NA
    timeAvgSynCount[, i] <- apply(fileContent, 2, mean)
}

timeAvgSynCount %>%
    mutate(ORF = 1:100) %>% 
    pivot_longer(names_to = "techRep", values_to = "timeAvgSynCount", !ORF) %>% 
    group_by(ORF) %>%
    summarise(timeRepAvgSynCount = mean(timeAvgSynCount)) %>%
    mutate(synRatePerSec = timeRepAvgSynCount/60,
           inputSynRate = read_tsv("../input/allGenesDecrEqualsSynr_dc_0_r_0_S.cer.mRNA.ini.abndc.syn.dec", col_names = FALSE) %>% pull(X3),
           relSynRate = synRatePerSec/inputSynRate) %>% 
    ggplot(aes(y=relSynRate)) +
    geom_boxplot(outlier.size = 0.1) +
    theme_bw() +
    labs(x="dc_0_r_0",
       y="Relative mean mRNA synthesis rates") +
    theme(
    text = element_text(size = 13),
    )

```

Calculate the mRNA decay rates from the decay count, instead of life times.
```{r}
decCountFiles <- list.files("../output/gene_sp_decCount_perMin/")

timeAvgDecCount <- as_tibble(matrix(NA, nrow = numGenes, ncol = numTechReps))
for (i in 1:numTechReps){
    fileContent <- read_delim(paste0("../output/gene_sp_decCount_perMin/", decCountFiles[i]), col_names = FALSE)[,2:101] # ignore the first col=timeMark,last col= NA
    timeAvgDecCount[, i] <- apply(fileContent, 2, mean)
}

timeAvgDecCount %>%
    mutate(ORF = 1:100) %>% 
    pivot_longer(names_to = "techRep", values_to = "timeAvgDecCount", !ORF) %>% 
    group_by(ORF) %>%
    summarise(timeRepAvgDecCount = mean(timeAvgDecCount)) %>%
    mutate(decRatePerSec = timeRepAvgDecCount/(60*200),  # also divided by 200 because the decay rates are for all 200 initial mRNAs altogether
           inputDecRate = read_tsv("../input/allGenesDecrEqualsSynr_dc_0_r_0_S.cer.mRNA.ini.abndc.syn.dec", col_names = FALSE) %>% pull(X4),
           relDecRate = decRatePerSec/inputDecRate) %>%  
    ggplot(aes(y=relDecRate)) +
    geom_boxplot(outlier.size = 0.1) +
    theme_bw() +
    labs(x="dc_0_r_0",
       y="Relative mean mRNA decay rates\n(calculated from decay counts)") +
    theme(
    text = element_text(size = 13),
    )

```



